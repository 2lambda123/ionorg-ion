syntax = "proto3";

option go_package = "github.com/pion/ion/apps/room/proto";

package room;

service Room {
  rpc Signal(stream Request) returns (stream Reply) {}
}

message Request {
  oneof payload {
    JoinRequest join = 1;
    LeaveRequest leave = 2;
    AddParticipantRequest addParticipant = 3;
    RemoveParticipantRequest removeParticipant = 4;
    LockConferenceRequest lockConference = 5;
    GetParticipantsRequest getParticipants = 6;
    EndConferenceRequest endConference = 7;
    SendMessageRequest sendMessage = 8;
    SetImportanceRequest setImportance = 9;
    EditParticipantInfoRequest editParticipantInfo = 10;
  }
}

message Reply {
  oneof payload {
    JoinReply join = 1;
    LeaveReply leave = 2;
    AddParticipantReply addParticipant = 3;
    RemoveParticipantReply removeParticipant = 4;
    LockConferenceReply lockConference = 5;
    GetParticipantsReply getParticipants = 6;
    EndConferenceReply endConference = 7;
    SendMessageReply sendMessage = 8;
    SetImportanceReply setImportance = 9;
    EditParticipantInfoReply editParticipantInfo = 10;
    Notification notification = 11;
  }
}

message Empty {}

message JoinRequest {
  string sid = 1;
  string uid = 2;
  string displayName = 3;
  bytes extraInfo = 4;
  Role role = 5;
  string avatar = 6;
  string vendor = 7;
  string token = 8;
}

message Permission {
  bool addParticipants = 1;
  bool removeParticipants = 2;

  bool blockOthersAudio = 3;
  bool blockOthersVideo = 4;

  bool endConference = 7;
  bool lockConference = 8;

  bool publish = 9;
  bool subscribe = 10;

  bool setImportance = 11;
}

message Configuration {
  string uuid = 1; // unique id for the room.
  bool isAudioOnlyMode = 2;
  Role role = 3;
  Permission yourPermission = 4;
}

message JoinReply {
  bool success = 1;
  Configuration config = 2;
  Error error = 3;
}

message LeaveRequest {
  string sid = 1;
  string uid = 2;
}

message LeaveReply {
  bool success = 1;
  Error error = 2;
}

enum Role {
  RoleHost = 0;
  RoleGuest = 1;
}

enum Protocol {
  ProtocolUnknown = 0;
  ProtocolWebRTC = 1;
  ProtocolSIP = 2;
  ProtocolRTMP = 3;
}

message Participant {
  string uid = 1;
  string displayName = 2;
  bytes extraInfo = 3;
  Role role = 4;
  Protocol protocol = 5;
  string avatar = 6;
  string callDirection = 7; // 'in' or 'out'
  string vendor = 8;        // device info
}

message GetParticipantsRequest {}

message GetParticipantsReply { Participant participants = 1; }

message Error {
  int32 code = 1;
  string reason = 2;
}

enum StreamType {
  UserMedia = 0;
  Presentation = 1;
  Streaming = 2;
}

message Message {
  string origin = 1; // Name of the sending participant.
  string uid = 3;    // UUID of the sending participant.
  string type = 4;   // MIME content-type of the message, usually text/plain.
  bytes payload = 5; // Payload message contents.
}

message SendMessageRequest { Message message = 1; }
message SendMessageReply {
  bool success = 1;
  Error error = 2;
}

message Disconnect { string reason = 1; }

enum ParticipantStatus {
  Create = 0;
  Update = 1;
  Delete = 2;
}

message ParticipantEvent {
  Participant participant = 1;
  ParticipantStatus status = 2;
}

message Notification {
  oneof payload {
    ParticipantEvent participant = 1;
    Message message = 2;
    Disconnect disconnect = 3;
    Error error = 4;
  }
}

message AddParticipantRequest {
  Role role = 1;
  string description = 2;
  Protocol protocol = 3;
  string source_display_name = 4;
}

message AddParticipantReply {
  bool success = 1;
  Error error = 2;
  Participant description = 3;
}

message SetImportanceRequest { repeated Participant participants = 1; }
message SetImportanceReply {
  bool success = 1;
  Error error = 2;
}

message LockConferenceRequest {
  bool lock = 1;
  string password = 2;
}

message LockConferenceReply {
  bool success = 1;
  Error error = 2;
}

message EndConferenceRequest { string reason = 1; }

message EndConferenceReply {
  bool success = 1;
  Error error = 2;
}

message EditParticipantInfoRequest {
  string uid = 1;
  string displayName = 2;
}
message EditParticipantInfoReply {
  bool success = 1;
  Error error = 2;
}

message RemoveParticipantRequest { string uid = 1; }

message RemoveParticipantReply {
  bool success = 1;
  Error error = 2;
}
